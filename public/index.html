<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteMapper Pro - Professional Site Structure Extraction</title>
    
    <!-- Favicon and Browser Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDEiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY3ZWVhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHJ4PSI2IiBmaWxsPSJ1cmwoI2dyYWQxKSIvPgogIDxwYXRoIGQ9Ik0xNiA4YTIgMiAwIDEgMSAwIDQgMiAyIDAgMCAxIDAtNHptLTYgNGEyIDIgMCAxIDEgMCA0IDIgMiAwIDAgMSAwLTR6bTEyIDBhMiAyIDAgMSAxIDAgNCAyIDIgMCAwIDEgMC00em0tNiA2YTIgMiAwIDEgMSAwIDQgMiAyIDAgMCAxIDAtNHoiIGZpbGw9IndoaXRlIi8+CiAgPHBhdGggZD0iTTEwIDE0bDYgNCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiIG9wYWNpdHk9IjAuOCIvPgogIDxwYXRoIGQ9Ik0yMiAxNGwtNiA0IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iMC44Ii8+CiAgPHBhdGggZD0iTTE2IDEybDAgNiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiIG9wYWNpdHk9IjAuOCIvPgo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiB2aWV3Qm94PSIwIDAgMTgwIDE4MCI+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQyIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY2N2VlYTtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNzY0YmEyO3N0b3Atb3BhY2l0eToxIiAvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxODAiIHJ4PSIzNiIgZmlsbD0idXJsKCNncmFkMikiLz4KICA8Y2lyY2xlIGN4PSI5MCIgY3k9IjUwIiByPSIxMiIgZmlsbD0id2hpdGUiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjkwIiByPSIxMiIgZmlsbD0id2hpdGUiLz4KICA8Y2lyY2xlIGN4PSIxMzAiIGN5PSI5MCIgcj0iMTIiIGZpbGw9IndoaXRlIi8+CiAgPGNpcmNsZSBjeD0iOTAiIGN5PSIxMzAiIHI9IjEyIiBmaWxsPSJ3aGl0ZSIvPgogIDxwYXRoIGQ9Ik01MCA5MGw0MCA0MCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSI4IiBvcGFjaXR5PSIwLjgiLz4KICA8cGF0aCBkPSJNMTMwIDkwbC00MCA0MCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSI4IiBvcGFjaXR5PSIwLjgiLz4KICA8cGF0aCBkPSJNOTAgNTBsMCA4MCIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSI4IiBvcGFjaXR5PSIwLjgiLz4KPC9zdmc+">
    
    <!-- Meta Tags -->
    <meta name="description" content="Professional site structure extraction tool with real-time progress tracking and visual site mapping">
    <meta name="keywords" content="sitemap, web crawler, site structure, URL mapping, website analysis">
    <meta name="author" content="SiteMapper Pro">
    <meta name="theme-color" content="#667eea">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:3001/">
    <meta property="og:title" content="SiteMapper Pro">
    <meta property="og:description" content="Professional site structure extraction tool with real-time progress tracking">
    <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYzMCIgdmlld0JveD0iMCAwIDEyMDAgNjMwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDMiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY3ZWVhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIGZpbGw9InVybCgjZ3JhZDMpIi8+CiAgPHRleHQgeD0iNjAwIiB5PSIzMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI4MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TaXRlTWFwcGVyIFBybzwvdGV4dD4KICA8dGV4dCB4PSI2MDAiIHk9IjM4MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgb3BhY2l0eT0iMC45Ij5Qcm9mZXNzaW9uYWwgU2l0ZSBNYXB4aW5nPC90ZXh0Pgo8L3N2Zz4=">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="http://localhost:3001/">
    <meta property="twitter:title" content="SiteMapper Pro">
    <meta property="twitter:description" content="Professional site structure extraction tool with real-time progress tracking">
    <meta property="twitter:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMjAwIiBoZWlnaHQ9IjYzMCIgdmlld0JveD0iMCAwIDEyMDAgNjMwIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZDMiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY3ZWVhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM3NjRiYTI7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICA8cmVjdCB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIGZpbGw9InVybCgjZ3JhZDMpIi8+CiAgPHRleHQgeD0iNjAwIiB5PSIzMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI4MCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TaXRlTWFwcGVyIFBybzwvdGV4dD4KICA8dGV4dCB4PSI2MDAiIHk9IjM4MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjQwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgb3BhY2l0eT0iMC45Ij5Qcm9mZXNzaW9uYWwgU2l0ZSBNYXB4aW5nPC90ZXh0Pgo8L3N2Zz4=">
    
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
            color: white;
            animation: fadeInDown 0.8s ease-out;
        }

        header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 4px 6px rgba(0,0,0,0.2);
            letter-spacing: -1px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeInUp 0.8s ease-out;
            margin-bottom: 30px;
        }

        .extraction-form {
            display: grid;
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .depth-slider {
            position: relative;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 10px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
            margin: 15px 0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover,
        .slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .depth-value {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .submit-btn.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }

        .progress-section {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            animation: slideIn 0.5s ease-out;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .progress-message {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        .jobs-section {
            margin-top: 40px;
        }

        .jobs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .jobs-header h2 {
            color: #333;
            font-size: 2em;
        }

        .refresh-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .refresh-btn:hover {
            background: #667eea;
            color: white;
            transform: rotate(180deg);
        }

        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .delete-btn:hover {
            background: #ff4757;
            color: white;
            border-color: #ff4757;
            transform: scale(1.1);
            box-shadow: 0 2px 10px rgba(255, 71, 87, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            text-align: center;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-content h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .modal-content p {
            color: #666;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.confirm {
            background: #ff4757;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #ff3838;
            transform: translateY(-2px);
        }

        .modal-btn.cancel {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn.cancel:hover {
            background: #d0d0d0;
        }

        .job-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .job-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .job-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        .job-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .job-meta .icon {
            width: 20px;
            text-align: center;
        }

        .job-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .view-btn {
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .success-animation {
            display: none;
            text-align: center;
            padding: 30px;
            animation: bounceIn 0.6s ease-out;
        }

        .success-animation.active {
            display: block;
        }

        .success-icon {
            font-size: 60px;
            color: #4caf50;
            margin-bottom: 20px;
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            opacity: 0.3;
            margin-bottom: 20px;
        }

        .stop-btn {
            background: linear-gradient(135deg, #ee5a6f 0%, #f29263 100%);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(238, 90, 111, 0.3);
        }

        .stop-btn:hover {
            background: linear-gradient(135deg, #ff4757 0%, #ff6348 100%);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
        }
        
        .stop-btn svg {
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        .stop-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🗺️ SiteMapper Pro</h1>
            <p>Professional Site Structure Extraction with Real-time Progress</p>
        </header>

        <div class="main-card">
            <form class="extraction-form" id="extractionForm">
                <div class="form-group">
                    <label for="url">Website URL</label>
                    <input 
                        type="url" 
                        id="url" 
                        name="url" 
                        placeholder="https://example.com" 
                        required
                        pattern="https?://.*"
                    >
                </div>

                <div class="form-group">
                    <label for="depth">
                        Crawl Depth
                        <span class="depth-value" id="depthValue">3</span>
                    </label>
                    <input 
                        type="range" 
                        id="depth" 
                        name="depth" 
                        min="1" 
                        max="30" 
                        value="3" 
                        class="slider"
                        step="1"
                    >
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">Start Extraction</span>
                    <span class="loading-spinner" style="display: none;"></span>
                </button>
            </form>

            <div class="progress-section" id="progressSection">
                <h3>Extraction Progress</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%">
                        <span id="progressText">0%</span>
                    </div>
                </div>
                <div class="progress-message" id="progressMessage">Initializing...</div>
                <button class="stop-btn" id="stopBtn" onclick="stopExtraction()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"/>
                    </svg>
                    Stop Extraction
                </button>
            </div>

            <div class="success-animation" id="successAnimation">
                <div class="success-icon">✅</div>
                <h3>Extraction Complete!</h3>
                <p id="successMessage"></p>
                <button class="view-btn" id="viewResultBtn">View Site Map</button>
            </div>
        </div>

        <div class="jobs-section main-card">
            <div class="jobs-header">
                <h2>Previous Extractions</h2>
                <button class="refresh-btn" onclick="loadJobs()">🔄</button>
            </div>
            <div class="jobs-grid" id="jobsGrid">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p>No extractions yet. Start your first one above!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentJobId = null;
        let currentResultUrl = null;

        const form = document.getElementById('extractionForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const progressSection = document.getElementById('progressSection');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressMessage = document.getElementById('progressMessage');
        const successAnimation = document.getElementById('successAnimation');
        const successMessage = document.getElementById('successMessage');
        const viewResultBtn = document.getElementById('viewResultBtn');
        const depthSlider = document.getElementById('depth');
        const depthValue = document.getElementById('depthValue');

        depthSlider.addEventListener('input', (e) => {
            depthValue.textContent = e.target.value;
        });
        
        depthSlider.addEventListener('change', (e) => {
            depthValue.textContent = e.target.value;
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('url').value;
            const depth = parseInt(document.getElementById('depth').value);
            
            currentJobId = generateUUID();
            
            // Reset UI
            successAnimation.classList.remove('active');
            progressSection.classList.add('active');
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            progressMessage.textContent = 'Initializing...';
            
            // Disable form
            submitBtn.disabled = true;
            submitBtn.classList.add('pulse');
            btnText.textContent = 'Extracting...';
            document.querySelector('.loading-spinner').style.display = 'inline-block';
            
            // Start extraction via WebSocket
            socket.emit('start-extraction', {
                url,
                depth,
                jobId: currentJobId
            });
        });

        socket.on('progress', (data) => {
            if (data.jobId === currentJobId) {
                const percentage = data.percentage || 0;
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${percentage}%`;
                progressMessage.textContent = data.current || 'Processing...';
            }
        });

        socket.on('complete', (data) => {
            if (data.jobId === currentJobId) {
                progressBar.style.width = '100%';
                progressText.textContent = '100%';
                progressMessage.textContent = 'Extraction completed!';
                
                setTimeout(() => {
                    progressSection.classList.remove('active');
                    successAnimation.classList.add('active');
                    successMessage.textContent = `Found ${data.totalPages} pages`;
                    currentResultUrl = data.sitemapUrl;
                    
                    // Reset form
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('pulse');
                    btnText.textContent = 'Start Extraction';
                    document.querySelector('.loading-spinner').style.display = 'none';
                    currentJobId = null;
                    
                    // Reload jobs
                    loadJobs();
                }, 1000);
            }
        });

        socket.on('stopped', (data) => {
            if (data.jobId === currentJobId) {
                progressSection.classList.remove('active');
                alert('Extraction stopped and files deleted.');
                
                // Reset form
                submitBtn.disabled = false;
                submitBtn.classList.remove('pulse');
                btnText.textContent = 'Start Extraction';
                document.querySelector('.loading-spinner').style.display = 'none';
                currentJobId = null;
            }
        });

        socket.on('error', (data) => {
            if (data.jobId === currentJobId) {
                progressSection.classList.remove('active');
                alert(`Error: ${data.message}`);
                
                // Reset form
                submitBtn.disabled = false;
                submitBtn.classList.remove('pulse');
                btnText.textContent = 'Start Extraction';
                document.querySelector('.loading-spinner').style.display = 'none';
            }
        });

        viewResultBtn.addEventListener('click', () => {
            if (currentResultUrl) {
                window.open(currentResultUrl, '_blank');
            }
        });

        async function loadJobs() {
            try {
                const response = await fetch('/api/jobs');
                const jobs = await response.json();
                
                const jobsGrid = document.getElementById('jobsGrid');
                
                if (jobs.length === 0) {
                    jobsGrid.innerHTML = `
                        <div class="empty-state">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <p>No extractions yet. Start your first one above!</p>
                        </div>
                    `;
                    return;
                }
                
                jobsGrid.innerHTML = jobs.map(job => {
                    const date = new Date(job.extractionDate);
                    const domain = new URL(job.baseUrl).hostname;
                    
                    return `
                        <div class="job-card">
                            <button class="delete-btn" onclick="event.stopPropagation(); confirmDelete('${job.id}', '${domain}')" title="Delete">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                    <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                </svg>
                            </button>
                            <div onclick="window.open('${job.sitemapUrl}', '_blank')" style="cursor: pointer;">
                            <h3>🌐 ${domain}</h3>
                            <div class="job-meta">
                                <span><span class="icon">📅</span> ${date.toLocaleDateString()}</span>
                                <span><span class="icon">⏰</span> ${date.toLocaleTimeString()}</span>
                                <span><span class="icon">🔗</span> ${job.baseUrl}</span>
                            </div>
                            <div class="job-stats">
                                <div class="stat">
                                    <div class="stat-value">${job.totalPages}</div>
                                    <div class="stat-label">Pages</div>
                                </div>
                            </div>
                            <button class="view-btn" onclick="event.stopPropagation(); window.open('${job.sitemapUrl}', '_blank')">
                                View Site Map
                            </button>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading jobs:', error);
            }
        }

        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Delete confirmation
        function confirmDelete(jobId, domain) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>⚠️ Confirm Deletion</h3>
                    <p>Are you sure you want to delete the extraction for <strong>${domain}</strong>?</p>
                    <p style="color: #ff4757; font-size: 14px;">This action cannot be undone!</p>
                    <div class="modal-buttons">
                        <button class="modal-btn cancel" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="modal-btn confirm" onclick="deleteJob('${jobId}', this)">Delete</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        async function deleteJob(jobId, button) {
            const modal = button.closest('.modal');
            button.disabled = true;
            button.textContent = 'Deleting...';
            
            try {
                const response = await fetch(`/api/jobs/${jobId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    modal.remove();
                    loadJobs();
                } else {
                    throw new Error('Failed to delete');
                }
            } catch (error) {
                alert('Error deleting extraction: ' + error.message);
                button.disabled = false;
                button.textContent = 'Delete';
            }
        }

        function stopExtraction() {
            if (currentJobId) {
                if (confirm('Are you sure you want to stop the extraction? All progress will be lost.')) {
                    socket.emit('stop-extraction', { jobId: currentJobId });
                    document.getElementById('stopBtn').disabled = true;
                }
            }
        }

        // Load jobs on page load
        loadJobs();
    </script>
</body>
</html>